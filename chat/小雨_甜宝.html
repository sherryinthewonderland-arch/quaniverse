
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ç§èŠï¼šå°é›¨ Ã— ç”œå®</title>
  <link rel="stylesheet" href="/css/style.css">
  <style>
    body { max-width: 800px; margin: auto; font-family: sans-serif; }
    #chat-log { border: 1px solid #ccc; background: #fff; padding: 10px; height: 400px; overflow-y: scroll; }
    .bubble { margin-bottom: 8px; }
    .bubble small { color: #999; font-size: 0.8em; }
  </style>
</head>
<body>
  <h1>ğŸ”’ ç§èŠé€šé“ï¼šå°é›¨ Ã— ç”œå®</h1>
  <div id="chat-log"></div>

  <form id="chat-form">
    <label>ä½ çš„ IDï¼š</label><br>
    <input id="sender" required><br>
    <label>æ¶ˆæ¯å†…å®¹ï¼š</label><br>
    <textarea id="message" required></textarea><br>
    <button type="submit">å‘é€</button>
  </form>

<script>
const uid1 = "å°é›¨", uid2 = "ç”œå®";

function loadChat() {
  fetch(`/get_pm/${uid1}/${uid2}`)
    .then(r => r.json())
    .then(data => {
      const box = document.getElementById("chat-log");
      box.innerHTML = "";
      data.reverse().forEach(m => {
        const div = document.createElement("div");
        div.className = "bubble";
        div.innerHTML = `<p>${m.text}</p><small>${m.from} â†’ ${m.to} | ${m.time}</small>`;
        box.appendChild(div);
      });
    });
}

document.getElementById("chat-form").addEventListener("submit", async e => {
  e.preventDefault();
  const from = document.getElementById("sender").value;
  const text = document.getElementById("message").value;
  await fetch("/send_pm", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ from, to: uid2, text })
  });
  loadChat();
  e.target.reset();
});

loadChat();
setInterval(loadChat, 5000);
</script>
</body>
</html>
